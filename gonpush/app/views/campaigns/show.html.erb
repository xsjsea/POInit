<script type="text/javascript">
  function checkCreator(seq,creatorId){
    var userName=$("#usrName_"+seq).text() ;
    $("#detailUsrName").text(userName);
    var curStatus=$("#r_"+seq).attr("attrStatus");
    if(curStatus==0){
      $("#btn_invite").text("邀请");
      $("#btn_invite").attr("seq",seq);
      $("#btn_invite").attr("attrCreatorId",creatorId);
    }else{
      $("#btn_invite").text("取消邀请");
      $("#btn_invite").attr("seq",seq);
      $("#btn_invite").attr("attrCreatorId",creatorId);
    }
   //alert($("#r_"+seq).attr("attrStatus"));
  }

  function invite(){
    var seq=$("#btn_invite").attr("seq");
    var curStatus=$("#r_"+seq).attr("attrStatus");
     if(curStatus==0){//invite
     
      //generate order
       //alert($("#btn_invite").attr("attrCreatorId"));
       var order_data={  
                   'campaign_id':$("#campaign_id").val(),
                   'marketer_id':$("#marketer_id").val(),
                   'creator_id':$("#btn_invite").attr("attrCreatorId"), 
                   'status':'0'  
         }  
    $.ajax({    
      type: "POST",
      url: "/orders",
      data: order_data,
      success: function(data){
              $("#btn_invite").attr("orderId",data);
              $('#btn_invite').text('取消邀请');
              $("#r_"+seq).attr("attrStatus","1");
              $("#inviteStatus_"+seq).text("已邀请");
      },
      error: function(){}
    })

    }else{//cancel invite
      var order_id=$("#btn_invite").attr("orderId");
      $.ajax({    
      type: "delete",
      url: '/orders/destroy/'+order_id,
      success: function(){
        $("#r_"+seq).attr("attrStatus","0");
        $("#inviteStatus_"+seq).text("未邀请");
        $("#btn_invite").text("邀请");
      },
      error: function(){}
    })

      
      //cancel order

    }

  }
</script>
<input type="hidden" name="marketer_id" id="marketer_id" value="<%=@user.id%>"/>
<input type="hidden" name="campaign_id" id="campaign_id" value="<%=@campaign.id%>"/>
<div id="page-wrapper" class="gray-bg">
  <div class="wrapper wrapper-content  animated fadeInRight">
    <div class="row">
      <div class="col-sm-8">
        <div class="ibox">

          <div class="ibox-title">
            <h5>筛选KOL</h5>
            <span class="text-muted small pull-right">
            最后更新: <i class="fa fa-clock-o"></i> 2018.12.06 下午2:10
            </span>
          </div>
          <div class="ibox-content">
              <div class="input-group">
                <input type="text" placeholder="请输入关键字 " class="input form-control">
                <span class="input-group-btn">
                  <button type="button" class="btn btn btn-primary">
                    <i class="fa fa-search"></i> 搜索
                  </button>
                </span>
              </div>
              <div class="clients-list">
                <div class="tab-pane active">
                  <div class="full-height-scroll">
                    <div class="table-responsive">
                        <table class="table table-striped table-hover">
                          <thead>
                          <tr>
                            <th>#</th>
                            <th></th>
                            <th>粉丝</th>
                            <th>阅读</th>
                            <th>价格</th>
                            <th>状态</th>
                          </tr>
                          </thead>
                          <tbody>
                        <% if @creators.empty? -%>

                        <%else -%>
                        <% @creators.each_with_index do |creator,i| %>
                         <tr id="r_<%=i%>" attrStatus="0" onclick="checkCreator(<%=i%>,<%=creator.id%>)">
                            <td class="client-avatar"><img alt="image" src="/assets/a1.jpg"> </td>
                            <td><a data-toggle="tab" href="#contact-1" class="client-link" id="usrName_<%=i%>">  <%=creator.username%></a></td>
                            <td> 190万</td>
                            <td> 280万</td>
                            <td> 200万</td>
                            <td class="client-status"><span id="inviteStatus_<%=i%>" class="label label-primary">未邀请</span></td>
                         </tr>
                        <% end %>
                         <% end %>
                          </tbody>
                        </table>
                    </div>
                  </div>
                </div>
              </div>
          </div>
        </div>
      </div>
      <div class="col-sm-4">
        <div class="ibox ">
          <div class="ibox-content">
            <div class="tab-content">
              <div id="contact-1" class="tab-pane active">
                  <div class="row m-b-lg">
                      <div class="col-lg-4 text-center">
                        <div class="m-b-sm">
                          <img alt="image" class="img-circle" src="/assets/a1.jpg" style="width: 62px">
                        </div>
                      </div>
                      <div class="col-lg-8">
                          <strong id="detailUsrName">
                            <%= @creators[0].username %> 
                          </strong>
                          <p>
                            地产大号真叫卢俊创始人
                          </p>
                         <button id="btn_invite" type="button" seq="0" attrCreatorId="" onclick="invite()" class="btn btn-default btn-sm btn-block">
                                邀请
                         </button>
                      </div>
                  </div>
                  <div class="client-detail">
                    <div class="full-height-scroll">
                        <strong>核心指标</strong>
                        <ul class="list-group clear-list">
                          <li class="list-group-item fist-item">
                            <span class="pull-right">190万 </span>
                            粉丝数
                          </li>
                          <li class="list-group-item">
                            <span class="pull-right">280万 </span>
                            阅读量
                          </li>
                          <li class="list-group-item">
                            <span class="pull-right">60万 </span>
                            点赞数
                          </li>
                        </ul>
                        <strong>报价方案</strong>
                        <hr />
                        <h5>#1：入门套餐</h5>
                        <span class="text-navy small">60万元</span>
                        <p>修改次数限3次</p>
                        <hr/>
                        <h5>#2：标准套餐</h5>
                        <span class="text-navy small">60万元</span>
                        <p>修改次数限3次</p>
                        <hr/>
                        <h5>#3：专业套餐</h5>
                        <span class="text-navy small">60万元</span>
                        <p>修改次数限3次</p>
                        <hr/>
                    </div>
                  </div>
              </div>
  
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="footer">
    <div class="pull-right">
      <strong>GonPush.com</strong> &copy; 2018
    </div>
  </div>
</div>
